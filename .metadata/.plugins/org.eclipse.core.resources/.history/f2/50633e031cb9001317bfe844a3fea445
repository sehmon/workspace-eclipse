package com.sehmon.milestracker;

import java.util.ArrayList;

import android.app.Fragment;
import android.content.Intent;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.Menu;
import android.view.MenuInflater;
import android.view.MenuItem;
import android.view.View;
import android.view.ViewGroup;
import android.widget.TextView;
import android.widget.Toast;



public class MileHomeFragment extends Fragment {
	
	//This is the int needed to use startActivityForResult()
	private static final int GET_NEW_MILE = 1;
	
	private double mTotalNeeded = 50;
	private double mTotalRan;
	private double mTotalToGo;
	
	private ArrayList<Mile> mMiles;
	
	TextView mMilesNeededTextView;
	TextView mMilesRanTextView;
	TextView mMilesToGoTextView;
	
	
	
	@Override
	public void onCreate(Bundle savedInstanceState){
		super.onCreate(savedInstanceState);
		getActivity().setTitle(R.string.app_name);
		
		mMiles = MileLab.get(getActivity()).getMiles();
		
		//If you want to inflater a menu, THIS IS NEEDED!!!!!!!
		setHasOptionsMenu(true);
				
	}
	
	
	public MileHomeFragment newInstance(int title, String message){
		return new MileHomeFragment();
		}
	
	//Inflates the menu for the action bar
	@Override
	public void onCreateOptionsMenu(Menu menu, MenuInflater inflater) {
	    super.onCreateOptionsMenu(menu, inflater);
	    inflater.inflate(R.menu.miles_main, menu);
	}

	
	//This uses a switch to check which action bar button you press
	@Override
	public boolean onOptionsItemSelected(MenuItem item) {
	    switch (item.getItemId()) {
	        case R.id.action_new_mile:
	        	getNewMile();
	        	break;  
	        default:
	            return super.onOptionsItemSelected(item);
	    }
		return false;
	   
	}
	
	//The function called in the switch statement to get a new mile
	private void getNewMile(){
		Intent getMileIntent = new Intent(getActivity().getApplicationContext(), MileNewActivity.class);
		startActivityForResult(getMileIntent, GET_NEW_MILE);
	}
	
	
	//TODO set the rest of the mile attributes to the ones in the new_mile_fragment
	//This method deals with the addition of a new Mile
	@Override
	public void onActivityResult(int requestCode, int resultCode, Intent data) {
		mMiles = MileLab.get(getActivity()).getMiles();	
		View vg = getActivity().findViewById(R.id.homeViewGroup);
		
		if(requestCode == GET_NEW_MILE){
			Mile m = new Mile();
			m.setLength(data.getDoubleExtra("length", 0));
		}
		vg.invalidate();
		
	}
	


	
	@Override
    public View onCreateView(LayoutInflater inflater, ViewGroup parent,
            Bundle savedInstanceState) {
		
		View v = inflater.inflate(R.layout.fragment_mile_home, parent, false);
		
		mMilesNeededTextView = (TextView)v.findViewById(R.id.mile_needed_number);
		mMilesNeededTextView.setText(String.valueOf(this.mTotalNeeded));
		
		mTotalRan = MileLab.get(getActivity()).getTotalMileCount();
		mMilesRanTextView = (TextView)v.findViewById(R.id.mile_ran_number);
		mMilesRanTextView.setText(String.valueOf(String.valueOf(mTotalRan)));
		
		mTotalToGo = mTotalNeeded-mTotalRan;
		mMilesToGoTextView = (TextView)v.findViewById(R.id.mile_to_go_number);
		mMilesToGoTextView.setText(String.valueOf(mTotalToGo));
		
		v.invalidate();
		
		return v;
		
		
	}
	

	
}
